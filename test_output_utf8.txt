============================= test session starts =============================
platform win32 -- Python 3.11.8, pytest-9.0.1, pluggy-1.6.0
rootdir: E:\G\GeminiCLI\ai-test-project\kronos
plugins: anyio-4.11.0, langsmith-0.4.43, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 41 items

tests\test_api.py ...                                                    [  7%]
tests\test_api_jobs.py ..                                                [ 12%]
tests\test_core.py ....                                                  [ 21%]
tests\test_ingest_defensive.py DONE: FastPath zagrijan s 502 literalnih ulaza.
F.                                        [ 26%]
tests\test_integration_v4_v5.py ...                                      [ 34%]
tests\test_job_manager.py ....                                           [ 43%]
tests\test_query_detection.py .                                          [ 46%]
tests\test_temporal.py .....FF                                           [ 63%]
tests\test_types.py ....                                                 [ 73%]
tests\test_validation_security.py ..F...                                 [ 87%]
tests\test_watcher.py F                                                  [ 90%]
tests\test_watcher_batch.py .                                            [ 92%]
tests\test_worker.py ...                                                 [100%]

================================== FAILURES ===================================
_______________________ test_metadata_validation_basics _______________________

    def test_metadata_validation_basics():
        oracle = Oracle(db_path="data/store_test")
    
        # Valid metadata
>       assert oracle.validate_metadata({"source": "test.py", "start_line": 1, "end_line": 10}) is True
               ^^^^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'Oracle' object has no attribute 'validate_metadata'

tests\test_ingest_defensive.py:8: AttributeError
---------------------------- Captured stdout call -----------------------------
--- FastPath: Rust engine ucitan! ---
--- FastPath: Zagrijavam memorijski indeks... ---
______________ TestDebounceHandler.test_import_debounced_handler ______________

self = <test_temporal.TestDebounceHandler object at 0x000002010CB40A50>

    def test_import_debounced_handler(self):
        """Test da se DebouncedEventHandler mo₧e importirati."""
>       from src.modules.watcher import DebouncedEventHandler
E       ImportError: cannot import name 'DebouncedEventHandler' from 'src.modules.watcher' (E:\G\GeminiCLI\ai-test-project\kronos\src\modules\watcher.py)

tests\test_temporal.py:107: ImportError
_____________ TestDebounceHandler.test_debounce_interval_default ______________

self = <test_temporal.TestDebounceHandler object at 0x000002010CB41090>

    def test_debounce_interval_default(self):
        """Test defaultne vrijednosti debounce intervala."""
>       from src.modules.watcher import DebouncedEventHandler
E       ImportError: cannot import name 'DebouncedEventHandler' from 'src.modules.watcher' (E:\G\GeminiCLI\ai-test-project\kronos\src\modules\watcher.py)

tests\test_temporal.py:112: ImportError
_________________________ test_line_range_validation __________________________

    def test_line_range_validation():
        # Create a small temp file for testing
        test_file = "temp_test_lines.txt"
        with open(test_file, "w", encoding="utf-8") as f:
            f.write("Line 1\nLine 2\nLine 3\nLine 4\nLine 5\n")
    
        try:
            # Invalid start
            valid, err = validate_line_range(-1, 5, test_file)
            assert valid == False
    
            # End < Start
            valid, err = validate_line_range(5, 4, test_file)
            assert valid == False
    
            # Empty range
            valid, err = validate_line_range(5, 5, test_file)
>           assert valid == False
E           assert True == False

tests\test_validation_security.py:64: AssertionError
__________________________ test_watcher_detect_file ___________________________

test_env = ('C:\\Users\\sdeni\\AppData\\Local\\Temp\\pytest-of-sdeni\\pytest-18\\test_watcher_detect_file0\\watch', 'C:\\Users\\s...ytest-18\\test_watcher_detect_file0\\data', <test_watcher.test_env.<locals>.TestIngestor object at 0x0000020112CBD250>)

    def test_watcher_detect_file(test_env):
        watch_dir, data_dir, ingestor = test_env
    
>       from src.modules.watcher import DebouncedEventHandler
E       ImportError: cannot import name 'DebouncedEventHandler' from 'src.modules.watcher' (E:\G\GeminiCLI\ai-test-project\kronos\src\modules\watcher.py)

tests\test_watcher.py:35: ImportError
---------------------------- Captured stdout setup ----------------------------
--- FastPath: Rust engine ucitan! ---
--- FastPath: Zagrijavam memorijski indeks... ---
============================== warnings summary ===============================
src\server.py:568
  E:\G\GeminiCLI\ai-test-project\kronos\src\server.py:568: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

C:\Users\sdeni\AppData\Local\Programs\Python\Python311\Lib\site-packages\fastapi\applications.py:4575
C:\Users\sdeni\AppData\Local\Programs\Python\Python311\Lib\site-packages\fastapi\applications.py:4575
  C:\Users\sdeni\AppData\Local\Programs\Python\Python311\Lib\site-packages\fastapi\applications.py:4575: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

src\server.py:599
  E:\G\GeminiCLI\ai-test-project\kronos\src\server.py:599: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("shutdown")

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_ingest_defensive.py::test_metadata_validation_basics - Attr...
FAILED tests/test_temporal.py::TestDebounceHandler::test_import_debounced_handler
FAILED tests/test_temporal.py::TestDebounceHandler::test_debounce_interval_default
FAILED tests/test_validation_security.py::test_line_range_validation - assert...
FAILED tests/test_watcher.py::test_watcher_detect_file - ImportError: cannot ...
================== 5 failed, 36 passed, 4 warnings in 17.28s ==================
