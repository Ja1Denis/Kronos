============================= test session starts =============================
platform win32 -- Python 3.11.8, pytest-9.0.1, pluggy-1.6.0
rootdir: E:\G\GeminiCLI\ai-test-project\kronos
plugins: anyio-4.11.0, langsmith-0.4.43, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 41 items

tests\test_api.py ...                                                    [  7%]
tests\test_api_jobs.py ..                                                [ 12%]
tests\test_core.py ....                                                  [ 21%]
tests\test_ingest_defensive.py .F                                        [ 26%]
tests\test_integration_v4_v5.py ...                                      [ 34%]
tests\test_job_manager.py ....                                           [ 43%]
tests\test_query_detection.py .                                          [ 46%]
tests\test_temporal.py .......                                           [ 63%]
tests\test_types.py ....                                                 [ 73%]
tests\test_validation_security.py ......                                 [ 87%]
tests\test_watcher.py .                                                  [ 90%]
tests\test_watcher_batch.py F                                            [ 92%]
tests\test_worker.py ...                                                 [100%]

================================== FAILURES ===================================
_________________________ test_safe_upsert_enrichment _________________________

tmp_path = WindowsPath('C:/Users/sdeni/AppData/Local/Temp/pytest-of-sdeni/pytest-19/test_safe_upsert_enrichment0')

    def test_safe_upsert_enrichment(tmp_path):
        # Mocking collection to avoid real DB if possible, or just use a test DB
>       oracle = Oracle(db_path=str(tmp_path / "store"))
                 ^^^^^^
E       NameError: name 'Oracle' is not defined

tests\test_ingest_defensive.py:20: NameError
___________________ TestWatcherBatch.test_batch_submission ____________________

self = <test_watcher_batch.TestWatcherBatch testMethod=test_batch_submission>

    def test_batch_submission(self):
        # 1. Kreiraj/Promijeni viÜe datoteka brzo
        for i in range(5):
            file_path = os.path.join(self.test_dir, f"file_{i}.md")
            with open(file_path, "w") as f:
                f.write(f"Sadr₧aj datoteke {i}")
            time.sleep(0.1)
    
        # 2. \u010cekaj da debounce timer odradi svoje
        print("Waiting for batch timer...")
        time.sleep(2.0)
    
        # 3. Provjeri bazu (tra₧imo 'ingest_batch' job)
        next_job = self.manager.get_next_job()
>       self.assertIsNotNone(next_job, "Job nije kreiran")
E       AssertionError: unexpectedly None : Job nije kreiran

tests\test_watcher_batch.py:42: AssertionError
---------------------------- Captured stdout call -----------------------------
\x1b[36m\u2139\ufe0f  \U0001f440 Kronos Watcher (Batch Mode) pokrenut na: E:\\G\\GeminiCLI\\ai-test-project\\kronos\\tests\\test_watcher_batch\x1b[0m\n\x1b[36m\u2139\ufe0f  \u23f3 Detektirana promjena: file_0.md. Batch size: 1\x1b[0m\n\x1b[36m\u2139\ufe0f  \u23f3 Detektirana promjena: file_0.md. Batch size: 1\x1b[0m\n\x1b[36m\u2139\ufe0f  \u23f3 Detektirana promjena: file_1.md. Batch size: 2\x1b[0m\n\x1b[36m\u2139\ufe0f  \u23f3 Detektirana promjena: file_1.md. Batch size: 2\x1b[0m\n\x1b[36m\u2139\ufe0f  \u23f3 Detektirana promjena: file_2.md. Batch size: 3\x1b[0m\n\x1b[36m\u2139\ufe0f  \u23f3 Detektirana promjena: file_2.md. Batch size: 3\x1b[0m\n\x1b[36m\u2139\ufe0f  \u23f3 Detektirana promjena: file_2.md. Batch size: 3\x1b[0m\n\x1b[36m\u2139\ufe0f  \u23f3 Detektirana promjena: file_3.md. Batch size: 4\x1b[0m\n\x1b[36m\u2139\ufe0f  \u23f3 Detektirana promjena: file_3.md. Batch size: 4\x1b[0m\n\x1b[36m\u2139\ufe0f  \u23f3 Detektirana promjena: file_4.md. Batch size: 5\x1b[0m\n\x1b[36m\u2139\ufe0f  \u23f3 Detektirana promjena: file_4.md. Batch size: 5\x1b[0m\nWaiting for batch timer...\n\x1b[32m\u2705 \U0001f680 Watcher poslao batch posao aa2d3ef5-7276-4f09-b83a-f28813404f76 (5 datoteka)\x1b[0m\n\x1b[36m\u2139\ufe0f  \U0001f6d1 Watcher zaustavljen.\x1b[0m
------------------------------ Captured log call ------------------------------
INFO     Kronos:logger.py:31 \U0001f440 Kronos Watcher (Batch Mode) pokrenut na: E:\\G\\GeminiCLI\\ai-test-project\\kronos\\tests\\test_watcher_batch\nINFO     Kronos:logger.py:31 \u23f3 Detektirana promjena: file_0.md. Batch size: 1\nINFO     Kronos:logger.py:31 \u23f3 Detektirana promjena: file_0.md. Batch size: 1\nINFO     Kronos:logger.py:31 \u23f3 Detektirana promjena: file_1.md. Batch size: 2\nINFO     Kronos:logger.py:31 \u23f3 Detektirana promjena: file_1.md. Batch size: 2\nINFO     Kronos:logger.py:31 \u23f3 Detektirana promjena: file_2.md. Batch size: 3\nINFO     Kronos:logger.py:31 \u23f3 Detektirana promjena: file_2.md. Batch size: 3\nINFO     Kronos:logger.py:31 \u23f3 Detektirana promjena: file_2.md. Batch size: 3\nINFO     Kronos:logger.py:31 \u23f3 Detektirana promjena: file_3.md. Batch size: 4\nINFO     Kronos:logger.py:31 \u23f3 Detektirana promjena: file_3.md. Batch size: 4\nINFO     Kronos:logger.py:31 \u23f3 Detektirana promjena: file_4.md. Batch size: 5\nINFO     Kronos:logger.py:31 \u23f3 Detektirana promjena: file_4.md. Batch size: 5\nINFO     Kronos:logger.py:35 SUCCESS: \U0001f680 Watcher poslao batch posao aa2d3ef5-7276-4f09-b83a-f28813404f76 (5 datoteka)\nINFO     Kronos:logger.py:31 \U0001f6d1 Watcher zaustavljen.
============================== warnings summary ===============================
src\server.py:568
  E:\G\GeminiCLI\ai-test-project\kronos\src\server.py:568: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

C:\Users\sdeni\AppData\Local\Programs\Python\Python311\Lib\site-packages\fastapi\applications.py:4575
C:\Users\sdeni\AppData\Local\Programs\Python\Python311\Lib\site-packages\fastapi\applications.py:4575
  C:\Users\sdeni\AppData\Local\Programs\Python\Python311\Lib\site-packages\fastapi\applications.py:4575: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

src\server.py:599
  E:\G\GeminiCLI\ai-test-project\kronos\src\server.py:599: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("shutdown")

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_ingest_defensive.py::test_safe_upsert_enrichment - NameErro...
FAILED tests/test_watcher_batch.py::TestWatcherBatch::test_batch_submission
================== 2 failed, 39 passed, 4 warnings in 18.70s ==================
